{% extends "admin/base_site.html" %}
{% load i18n %}
{% block breadcrumbs %}
{% load staticfiles %}
{% csrf_token %}

<link rel="stylesheet"  type="text/css" href="{% static "css/bootstrap.min.css" %}"/>
<script src="{% static "js/jquery.min.js" %}"></script>
<script src="{% static "js/bootstrap.min.js" %}"></script>

<div>
  <ol class="breadcrumb">
      <li><a href="{% url 'index' %}">Home</a></li>
  </ol>
</div>

<head>

<style>
  #rcorners2 {
    border-radius: 10px;
    border: 2px solid #dee0e2;
    background: white;
    padding: 20px;
    width:auto;
  }
</style>


<script>



var gform;

$(document).ready(function(){

    surveyformlist();

    $("[name='Questionid']").hide();
 
    $("[name='Optionid']").hide();

    $("[name='Optionsparam']").hide(); 

    $("[name='Operation']").hide();



    $("[name='formid']").on('change',function(event)
    { 
       // console.log(event.target.parents());
  
        var target = $(event.target);
        
        parentobject = target.parent().parent();

    //    console.log(p);

 
        formkey=parentobject.find("[name='formidselect'] option:selected").val();
       
        questionlist(parentobject,formkey);
    });

    $("[name='Questionid']").on('change',function(event)
    {

       // $("[name='Optionid']").hide(); 

         var target = $(event.target);
        
        parentobject = target.parent().parent();

        questionname=parentobject.find("[name='Questionidselect'] option:selected").text();

        optionlist(parentobject);
    });

    $("#Add").click(function(){
        $(".cardexample").first().clone(true).appendTo("#cardlist");
        $("#cardlist").children().show(); 
    });


    $("#Submit").click(function(){

      var fdata = [];

      alert("submit button clicked"); 
      console.log("submit button clicked");
      
      var cardlist = document.getElementById("cardlist");
    
      cards=$("[name='card']");

      
      console.log("length of cards after jquery");
      console.log(cards.length);

      
      var acards = [];

      for(i=0;i<cards.length;i++)
       {
           acards.push(cards[i]); 
       }  
      

        acards.shift(); 

        console.log(acards);

        console.log("length of acards array");

        console.log(acards.length);

        for(i=0;i<acards.length;i++)
         {

            var q = [];

            console.log("card of ");
            console.log(i);

            cardtree = acards[i];

            console.log("cardtree of");
            console.log(i);
            console.log(cardtree);

            formname= $(cardtree).find("[name='formidselect'] option:selected").text();
          
            console.log("formname");
            console.log(formname);
          
            formid= $(cardtree).find("[name='formidselect'] option:selected").val();

            console.log("formid");
            console.log(formid);
            
            Questionname = $(cardtree).find("[name='Questionidselect'] option:selected").text();
            
            console.log("Questionname"); 
            console.log(Questionname);

            Questionid  = $(cardtree).find("[name='Questionidselect'] option:selected").val();
            
            console.log("Questionid");
            console.log(Questionid);


            console.log("Option list");
          

            optionnames = $(cardtree).find("[name=checkbox]:checked"); 
          

            console.log("length of optionlist");

            op = []

            console.log(optionnames.length);
           // console.log(optionnames);

              for (j=0;j<optionnames.length;j++)
              {
                  op.push(optionnames[j].value);
                  //console.log(optionnames[j].value);
              }

              console.log("options of questions");

              console.log(op);

            q.push({
              Questionid :   Questionid,
              Options  :    op
            });


            fdata.push({
              formid :    formid,
              Question  :    q
            });

          }

          gform=fdata;

          console.log("fdata");
          //console.log(fdata);

             getdata(fdata);

    }); 


});



function getdata(fdata){

    console.log(fdata);

 
   //console.log(data);

    var url = "{% url 'getformdata' %}";

    console.log(url);

    $.ajax({

        url : url,

        data : {'data':JSON.stringify(fdata)},

        type: "POST",

        contenttype : "json",

        success : function(json){

            gform=json;
            alert("I am here");
            alert(json);
            console.log(json);
    
        }


    });
}



function surveyformlist(){

    var url = "{% url 'surveyformlist' %}";

    $.ajax({

        url : url,

        //data : {},

        type: "GET",

        contenttype : "json",

        success : function(json){

              var str='<option value="';
              str = str +"0" +'"'+'>' + "---select---" + '</option>';
              $("[name='formidselect']").append(str);

        for (i = 0; i < json.nameArray.length; i++){
                var str='<option value="';
                str = str +json.idArray[i] +'"'+'>' + json.nameArray[i] + '</option>';
                $("[name='formidselect']").append(str);
            }

        }


    });

}





function questionlist(parentobject,formkey){

      console.log("quetiondropdown");

      quetiondropdown =  parentobject.find("[name='Questionid']");

      console.log(quetiondropdown);

      quetionlist = parentobject.find("[name='Questionidselect']");

      Operation = parentobject.siblings().find("[name='Operation']");

      console.log("Operation");
      console.log(Operation);


      Optionsparam = parentobject.find("[name='Optionsparam']");

      console.log(quetionlist);

    
     //$(quetionlist).hide(); 

     $(Operation).hide();

     $(Optionsparam).hide(); 

     $(quetionlist).empty();

    var url = "{% url 'questionlist' %}";

    $.ajax({

        url : url,

        data : {id:formkey},

        type: "POST",

        contenttype : "json",

        success : function(json){

                //gform=json["form"];  

                Questionarray=json["form"]; 

                if(Questionarray.length!=0)                 
                {  
                    var str='<option value="';
             
                    str = str +"0" +'"'+'>' + "---select---" + '</option>';
                    $(quetionlist).append(str);

                    for (i = 0; i < Questionarray.length; i++)
                    {
                        var str='<option value="';
                        str = str + Questionarray[i]["key"] +'"'+'>' + Questionarray[i]["value"] + '</option>';
                        $(quetionlist).append(str);
  
                    }  
                  
                    $(quetiondropdown).show();

                }  

              }  

    });


}


function optionlist(parentobject){


    console.log(questionname);

    formkey=parentobject.find("[name='formidselect'] option:selected").val();

    console.log("formkey");

    console.log(formkey);

    questionname = parentobject.find("[name='Questionidselect'] option:selected").text();

    console.log("questionname")

    console.log(questionname);


    Optioncheckboxlist = parentobject.find("[name='Optioncheckboxlist']");

    Optiondiv = parentobject.find("[name='Optionidselect']");

    Operation = parentobject.find("[name='Operation']");

    Optionsparam = parentobject.find("[name='Optionsparam']");



    $(Optioncheckboxlist).empty();


    var url = "{% url 'optionlist' %}";

    console.log(url);

    $.ajax({

        url : url,

        data : {formkey:formkey,questionname:questionname},

         type:'POST',

        contenttype : "json",

       

        success : function(json){

          optionslistarray=json;

          if(optionslistarray.length!=0)
          { 

     
            for(i = 0; i < optionslistarray.length; i++)
            {

     str = "<li class=\"list-group-item\"><input name=\"checkbox\" type=\"checkbox\"  value=\"" + optionslistarray[i]["key"] +"\">" 


              str = str + optionslistarray[i]["value"] + "</li>"

              $(Optioncheckboxlist).append(str);
  
            }  

            $(Optionsparam).show();
            Operation = parentobject.siblings();
            $(Operation).hide();
            $(Optiondiv).show();
           } 
          else{
            console.log("I am in else block");
            $(Optionsparam).hide();
            $(Optiondiv).hide();

            Operation = parentobject.siblings();
            console.log(Operation);
            $(Operation).show();
          }

      },

                 
      error: function(e){
              console.log(e);

      },

       
    

    });


}


</script>

</head>

<body>


<!-- start of card sample  -->

<div style = "margin-left:2%;margin-right: 1%;display:none;" class="cardexample" id="card" name="card">

  <div id="rcorners2" style="width:90%;">
    
    <div class="row" >
        
        <div class = "col-md-2" name ="formid" id ="formid">
            
            <select id="formidselect" name ="formidselect" class="form-control">                  
            </select>

        </div>

        

       <div class = "col-md-5"  name = "Questionid" id ="Questionid">
            
            <select id="Questionidselect"  name = "Questionidselect" class="form-control">
            </select>

        </div>


        <div class = "col-md-2" name= "Optionsparam" id ="Optionsparam" >

            <select class="form-control" name="Optionsparamlist">
             <option value=""> equal </option>
             <option value="">not equal </option>
            <option value="">answered</option>
             <option value="">not answered</option>
             <option value="<">equal to</option>
            </select> 

        </div>

        <div id="Optionidselect" name="Optionidselect" class="col-md-3" style="max-height:100px;overflow: auto;">
              <ul class="list-group" name ="Optioncheckboxlist" id="Optioncheckboxlist">
              </ul>
        </div>

    </div>




<br>

<div id ="Operation" name="Operation">
      <div class="row">
        
        <div class = "col-md-4" id ="">

          <select>
           <option value="<=">greater than equal to </option>
           <option value=">=">less than equal to</option>
           <option value=">">greater than</option>
           <option value="<">less than</option>
            <option value="<">equal to</option>
          </select> 

        </div>
          
         <div class = "col-md-4" id =""> 
              <input type="text" name="fromtext" value="">
         </div>         

      </div>  
    
    <br>

    <div class="row">
        
        <div class = "col-md-4" id ="">

          <select>
           <option value="<=">greater than equal to </option>
           <option value=">=">less than equal to</option>
           <option value=">">greater than</option>
           <option value="<">less than</option>
           <option value="<">equal to</option>
          </select> 

        </div>
          
         <div class = "col-md-4" id =""> 
              <input type="text" name="totext" value="">
         </div>         

      </div>

    </div> 


</div>

</div>


<!-- end of card sample  -->





<!-- start of Querybuilder  -->

<div id="Querybuilder" name ="Querybuilder">

  
<!-- start of row  -->

  <div class="row" >

    <button  style = "margin-left:2%;margin-right: 1%;"type="button" class="btn btn-info" data-toggle="collapse" data-target="#Questions">Questions</button>

      <!-- start of Questions  -->
  <br>
  <br>
<div id="Questions" name="Questions">
  
<div name="cardlist" id="cardlist">

<div style = "margin-left:2%;margin-right: 1%;" class="card" id="card" name="card">

  <div id="rcorners2" style="width:90%;">
    
    <div class="row" >
        
        <div class = "col-md-2" name ="formid" id ="formid">
            
            <select id="formidselect" name ="formidselect" class="form-control">                  
            </select>

        </div>

        

       <div class = "col-md-5"  name = "Questionid" id ="Questionid">
            
            <select id="Questionidselect"  name = "Questionidselect" class="form-control">
            </select>

        </div>


        <div class = "col-md-2" name= "Optionsparam" id ="Optionsparam" >

            <select class="form-control" name="Optionsparamlist">
             <option value=""> equal </option>
             <option value="">not equal </option>
            <option value="">answered</option>
             <option value="">not answered</option>
             <option value="<">equal to</option>
            </select> 

        </div>

        <div id="Optionidselect" name="Optionidselect" class="col-md-3" style="max-height:100px;overflow: auto;">
              <ul class="list-group" name ="Optioncheckboxlist" id="Optioncheckboxlist">
              </ul>
        </div>

    </div>


<br>


<div id ="Operation" name="Operation">
      <div class="row">
        
        <div class = "col-md-4" id ="">

          <select id="fromtextselectlist">
           <option value="<=">greater than equal to </option>
           <option value=">=">less than equal to</option>
           <option value=">">greater than</option>
           <option value="<">less than</option>
           <option value="<">equal to</option>
          </select> 

        </div>
          
         <div class = "col-md-4" id =""> 
              <input type="text" name="fromtext" value="">
         </div>         

      </div>  
    
      <br>

    <div class="row">
        
        <div class = "col-md-4" id ="">

          <select name="totextselectlist">
           <option value="<=">greater than equal to </option>
           <option value=">=">less than equal to</option>
           <option value=">">greater than</option>
           <option  value="<">less than</option>
           <option value="<">equal to</option>
          </select> 

        </div>
          
         <div class = "col-md-4" id =""> 
              <input type="text" name="totext" value="">
         </div>         

      </div>

    </div> 


</div>

</div>

</div>
    
    <br>
   <div style = "margin-left:2%;margin-right: 1%;" class = "col-md-6" id ="">

          <button class="btn btn-info" id="Add">ADD</button>

        </div> 



</div>

 <!-- end of Questions  -->


    </div>


  <br>
  <br>
    <!-- end of row  -->
    
    <!-- start of row  -->


  <div style = "margin-left:2%;margin-right: 1%;" class="row" >
  
    <button  type="button" class="btn btn-info" data-toggle="collapse" data-target="#answers">answers</button>
  
<!-- start of answers  -->

<div id="answers" name="answers">

    <div id="Optionidselect" name="Optionidselect" class="col-md-3" style="max-height:100px;overflow: auto;">
              <ul class="list-group" name ="Optioncheckboxlist" id="Optioncheckboxlist">
              </ul>
        </div>



</div>

<!-- end of answers  -->
    


  </div>
  
 

<!-- end of row  -->


 







</div>


<!-- end of Querybuilder  -->



<!-- start of submit button  -->

<div style = "margin-left:2%;margin-right: 1%;"> 
  <br>
  <br>
    <div class="row">
                        
        <div class = "col-md-6" id ="">

            <button class="btn btn-info" id="Submit" name="Submit">Submit</button>

        </div> 
         
        </div>

</div>

<!-- end of submit button  -->


</body>

</html>

{% endblock %}

{% block sidebar %}
{% endblock %}
